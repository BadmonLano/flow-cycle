<script>
  // === LIGHTWEIGHT CHARTS ===
  const chartElement = document.getElementById('chart');
  const chart = LightweightCharts.createChart(chartElement, {
    width: chartElement.clientWidth,
    height: chartElement.clientHeight,
    layout: { background: { type: 'solid', color: '#0d1117' }, textColor: '#c9d1d9' },
    grid: { vertLines: { color: '#30363d' }, horzLines: { color: '#30363d' } },
    crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
    rightPriceScale: { borderColor: '#30363d', scaleMargins: { bottom: 0.1, top: 0.1 } },
    timeScale: { borderColor: '#30363d', timeVisible: true, secondsVisible: false },
  });

  // Historical line (blue solid)
  const historicalSeries = chart.addLineSeries({
    color: '#58a6ff',
    lineWidth: 2,
    title: 'Flow Cycle Index (Historical)'
  });

  // Predicted line (dashed gray) - this is your 2-year forecast
  const predictedSeries = chart.addLineSeries({
    color: '#8b949e',
    lineWidth: 2,
    lineStyle: LightweightCharts.LineStyle.Dashed,
    title: 'Predicted (2-Year Forecast)'
  });

  // Your flow data (historical)
  const historicalData = [
    { time: '2017-01-01', value: 40 },
    { time: '2017-10-01', value: 45 },
    { time: '2017-12-01', value: 95 },
    { time: '2018-12-01', value: 10 },
    { time: '2020-03-01', value: 10 },
    { time: '2021-11-01', value: 90 },
    { time: '2022-11-01', value: 15 },
    { time: '2025-04-01', value: 25 },
    { time: '2025-11-01', value: 10 },
    { time: '2026-01-01', value: 51 }
  ];
  historicalSeries.setData(historicalData);

  // Predicted data - extended 2-year forecast (Jan 2026 â†’ Jan 2028)
  const predictedData = [
    { time: '2026-01-01', value: 51 },
    { time: '2026-04-01', value: 70 },
    { time: '2026-07-01', value: 85 },
    { time: '2026-10-01', value: 95 },
    { time: '2027-01-01', value: 80 },
    { time: '2027-04-01', value: 50 },
    { time: '2027-07-01', value: 30 },
    { time: '2027-10-01', value: 15 },
    { time: '2028-01-01', value: 10 }
  ];
  predictedSeries.setData(predictedData);

  // Set visible range to show recent history + full 2yr forecast
  // From ~mid-2025 (captures hope/panic bottom) to end-2027 (full prediction visible)
  const startDate = new Date('2025-06-01'); // adjustable - zoom out more if needed
  const endDate = new Date('2027-12-31');
  chart.timeScale().setVisibleRange({
    from: startDate.getTime() / 1000,
    to: endDate.getTime() / 1000
  });

  // Optional: Auto-fit on load if you prefer (but manual range above is better for forecast focus)
  // chart.timeScale().fitContent();

  // Resize handler
  window.addEventListener('resize', () => {
    chart.applyOptions({ width: chartElement.clientWidth, height: chartElement.clientHeight });
  });

  // Live prices fetch (unchanged)
  async function fetchLiveData() {
    try {
      const response = await fetch('https://pro-api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,ethereum,solana,bnb&order=market_cap_desc&per_page=4&page=1&sparkline=false&price_change_percentage=24h', {
        headers: { 'x-cg-pro-api-key': 'CG-16CjgPwWeLeNVZnNRmrfXiUz' }
      });
      if (!response.ok) throw new Error('API error');
      const data = await response.json();
      const pricesDiv = document.getElementById('prices');
      pricesDiv.innerHTML = '';
      data.forEach(coin => {
        const div = document.createElement('div');
        div.className = 'price-item';
        div.innerHTML = `
          <strong>${coin.name}</strong><br>
          <span style="font-size:1.4em;">$${coin.current_price.toLocaleString()}</span> 
          <span style="color:${coin.price_change_percentage_24h >= 0 ? '#56d364' : '#f85149'};">${coin.price_change_percentage_24h.toFixed(2)}%</span>
        `;
        pricesDiv.appendChild(div);
      });
    } catch (e) {
      document.getElementById('prices').innerHTML = '<p style="color:#f85149;">Live prices failed â€” refresh</p>';
    }
  }
  fetchLiveData();

  // Status (locked at Belief for now, can dynamic later)
  document.getElementById('statusBadge').innerHTML = 'ðŸŸ¡ WATCHING';
  document.getElementById('statusBadge').style.background = '#ffeb3b';
  document.getElementById('statusBadge').style.color = 'white';
  document.getElementById('actionAdvice').innerHTML = 'What you should do right now: Hold or buy dips.';
</script>
