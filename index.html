<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flow Cycle Index Dashboard (@BadmonLano)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
  <style>
    /* (your existing styles unchanged) */
  </style>
</head>
<body>
  <!-- (your HTML structure unchanged, just key parts below) -->

  <script>
    // Global vars
    let currentIndex = 51;
    let currentPhase = 'Anger';

    // ... (monthly dates, historicalMonthly, predictionMonthly, chart setup unchanged) ...

    // Dynamic index + phase update (unchanged, but now sets globals)
    async function updateDynamicIndexAndUI() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,solana&order=market_cap_desc&per_page=2&page=1&sparkline=false&price_change_percentage=30d');
        if (!res.ok) throw new Error();
        const data = await res.json();
        const btc30d = data[0]?.price_change_percentage_30d_in_currency || 0;
        const sol30d = data[1]?.price_change_percentage_30d_in_currency || 0;
        const avgMomentum = (btc30d + sol30d) / 2;

        currentIndex = Math.max(10, Math.min(90, 51 + Math.round(avgMomentum / 5)));

        currentPhase = 'Complacency';
        if (currentIndex >= 10) currentPhase = 'Anxiety';
        if (currentIndex >= 20) currentPhase = 'Denial';
        if (currentIndex >= 30) currentPhase = 'Panic';
        if (currentIndex >= 40) currentPhase = 'Capitulation';
        if (currentIndex >= 50) currentPhase = 'Anger';
        if (currentIndex >= 60) currentPhase = 'Depression';
        if (currentIndex >= 70) currentPhase = 'Disbelief';
        if (currentIndex >= 75) currentPhase = 'Hope';
        if (currentIndex >= 80) currentPhase = 'Optimism';
        if (currentIndex >= 85) currentPhase = 'Belief';
        if (currentIndex >= 90) currentPhase = 'Thrill';
        if (currentIndex >= 95) currentPhase = 'Euphoria';

        // Update UI (phase bar, badge, advice)
        document.querySelectorAll('.phase-segment').forEach(seg => {
          seg.classList.toggle('current-phase', seg.textContent.trim() === currentPhase);
        });

        const badge = document.getElementById('statusBadge');
        badge.innerHTML = `ðŸŸ¡ ${currentPhase.toUpperCase()}`;
        badge.style.background = currentIndex >= 90 ? '#ef4444' : currentIndex >= 70 ? '#eab308' : currentIndex >= 50 ? '#f59e0b' : '#22c55e';

        let advice = 'Hold or buy dips';
        if (currentPhase === 'Euphoria' || currentPhase === 'Thrill') advice = 'Trim/Sell strength â€” euphoria alert';
        else if (currentPhase === 'Panic' || currentPhase === 'Capitulation' || currentPhase === 'Depression') advice = 'Load bags heavy â€” bottom vibes';
        else if (currentPhase === 'Hope' || currentPhase === 'Belief' || currentPhase === 'Optimism') advice = 'Accumulate dips â€” legs building';
        document.getElementById('actionAdvice').innerHTML = `What you should do right now: ${advice}`;
      } catch (e) {
        console.log('Dynamic update failed:', e);
      }
    }
    updateDynamicIndexAndUI();

    // === GROK INSIGHT (fixed) ===
    const apiKey = 'PASTE_YOUR_REAL_GROK_API_KEY_HERE'; // <--- PUT YOUR KEY HERE (local only!)

    async function getGrokInsight() {
      const respDiv = document.getElementById('grok-response');
      respDiv.innerHTML = 'Grok cooking... ðŸ”¥';

      try {
        const res = await fetch('https://api.x.ai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'grok-4-1-fast-reasoning', // or 'grok-4-latest' if you prefer
            messages: [
              { role: 'system', content: 'You are a savage crypto trader with no filter. Give short, brutal, honest takes.' },
              { role: 'user', content: `Index ~${Math.round(currentIndex)} in ${currentPhase} phase. BTC ~$87k, SOL ~$122, $GORK rebounding. Blow-off Q4 2026? Move rn? Savage & short.` }
            ],
            temperature: 0.8,
            max_tokens: 200
          })
        });

        if (!res.ok) {
          const errText = await res.text();
          throw new Error(`API error ${res.status}: ${errText}`);
        }

        const data = await res.json();
        respDiv.innerHTML = data.choices[0].message.content.trim();
      } catch (err) {
        console.error(err);
        respDiv.innerHTML = `Error: ${err.message}. Check console for details (likely key/balance issue).`;
      }
    }

    document.getElementById('grok-button').addEventListener('click', getGrokInsight);

    // === $GORK (your real pair + Birdeye fallback) ===
    async function fetchGorkData() {
      const card = document.getElementById('gorkCard');
      card.innerHTML = '<strong>$GORK (Solana)</strong><br><div class="loading">Loading...</div>';

      try {
        // Primary: DexScreener
        let res = await fetch('https://api.dexscreener.com/latest/dex/tokens/76EDL5qNcte2ZH29quTaFzagXjWAEY83CATEjyA6pump');
        if (res.ok) {
          const data = await res.json();
          const pair = data.pairs?.[0] || {};
          card.innerHTML = `
            <strong>$GORK (Solana)</strong><br>
            <span style="font-size:1.4em;">$${pair.priceUsd?.toFixed(8) || 'N/A'}</span><br>
            MC: $${(pair.marketCap / 1e6)?.toFixed(2) || 'N/A'}M<br>
            24h Vol: $${(pair.volume?.h24 / 1e3)?.toFixed(0) || 'N/A'}K (${pair.priceChange?.h24?.toFixed(2) || 'N/A'}%)<br>
            Liq: $${(pair.liquidity?.usd / 1e3)?.toFixed(0) || 'N/A'}K<br>
            Buys/Sells (1h): ${pair.txns?.h1?.buys || '?'} / ${pair.txns?.h1?.sells || '?'}
          `;
          return;
        }
      } catch {}

      // Fallback: Birdeye (public)
      try {
        const res = await fetch('https://public-api.birdeye.so/public/price?address=76EDL5qNcte2ZH29quTaFzagXjWAEY83CATEjyA6pump', {
          headers: { 'X-API-KEY': 'free' } // public endpoint, no real key needed
        });
        if (res.ok) {
          const data = await res.json();
          const p = data.data || {};
          card.innerHTML = `
            <strong>$GORK (Solana)</strong><br>
            <span style="font-size:1.4em;">$${p.value?.toFixed(8) || 'N/A'}</span><br>
            MC: $${(p.mc / 1e6)?.toFixed(2) || 'N/A'}M<br>
            24h Change: ${p.priceChange24h?.toFixed(2) || 'N/A'}%
          `;
          return;
        }
      } catch {}

      card.innerHTML = '<strong>$GORK</strong><br><p style="color:#f85149;">Failed â€” refresh or check pair</p>';
    }
    fetchGorkData();

    // ... (rest of your code: fetchLiveData, fetchDailySummary, etc. unchanged) ...
  </script>
</body>
</html>
